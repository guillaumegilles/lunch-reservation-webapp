
<!DOCTYPE html>
<html>
<head>
    <title>{{ username }}'s Lunch Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-light">

<div class="container py-4">

    <div class="d-flex justify-content-between mb-3">
        <a class="btn btn-outline-primary" href="{{ url_for('admin_summary', year=year, month=month) }}">üîç Admin Page</a>
        <div>
            <a class="btn btn-primary" href="{{ url_for('calendar_view', username=username, year=prev_year, month=prev_month) }}">‚Üê Previous</a>
            <a class="btn btn-primary" href="{{ url_for('calendar_view', username=username, year=next_year, month=next_month) }}">Next ‚Üí</a>
        </div>
    </div>

    <h2 class="text-center mb-4">{{ username }}‚Äôs Lunch Calendar ‚Äî {{ month_name }} {{ year }}</h2>

    <div class="row g-4">
        <!-- Calendar -->
        <div class="col-12 col-lg-8">

            <div class="row fw-bold text-center mb-2">
                {% for weekday in ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"] %}
                <div class="col">{{ weekday }}</div>
                {% endfor %}
            </div>

            <div class="row g-2">
                {% for d in days %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-1 calendar-day"
                     id="day-{{ d.day }}"
                     onclick="selectDay({{ d.day }})">
                    <div class="p-2 border rounded text-center h-100">
                        <div>{{ d.day }}</div>
                        {% if lunches.get('%04d-%02d-%02d' % (year, month, d.day)) %}
                        <div class="small text-muted">
                            {{ lunches['%04d-%02d-%02d' % (year, month, d.day)] }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

        </div>

        <!-- Side Panel -->
        <div class="col-12 col-lg-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h4>Select a Day</h4>
                    <p id="selectedDay">None selected</p>

                    <select id="lunchOption" class="form-select mb-3">
                        <option value="">-- Choose lunch --</option>
                        {% for opt in options %}
                        <option value="{{ opt }}">{{ opt }}</option>
                        {% endfor %}
                    </select>

                    <button class="btn btn-success w-100 mb-2" onclick="saveLunch()">Save Lunch</button>
                    <p id="statusMsg" class="text-center small"></p>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
let selectedDay = null;
const username = "{{ username }}";
const year = {{ year }};
const month = {{ month }};

function selectDay(day) {
    document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('bg-primary', 'text-white'));
    const el = document.getElementById(`day-${day}`).firstElementChild;
    el.classList.add('bg-primary', 'text-white');

    selectedDay = day;
    document.getElementById('selectedDay').innerText = "Day " + day;
}

async function saveLunch() {
    const lunch = document.getElementById('lunchOption').value;
    if (!selectedDay || !lunch) { alert("Select a day and a lunch option."); return; }

    const response = await fetch("/save_lunch", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, day: selectedDay, lunch, year, month })
    });

    const data = await response.json();
    document.getElementById('statusMsg').innerText = data.message;

    const box = document.querySelector(`#day-${selectedDay} .small`);
    if (box) box.innerText = lunch;
}
</script>

</body>
</html>
d="lunchOption">
            <option value="">-- Choose lunch --</option>
            {% for opt in options %}
            <option value="{{ opt }}">{{ opt }}</option>
            {% endfor %}
        </select>
        <button onclick="saveLunch()">Save Lunch</button>
        <p id="statusMsg"></p>
    </div>

    <script>
        let selectedDay = null;
        const username = "{{ username }}";
        const year = {{ year }};
        const month = {{ month }};

        function selectDay(day) {
            document.querySelectorAll('.day').forEach(el => el.classList.remove('selected'));
            const el = document.getElementById(`day-${day}`);
            el.classList.add('selected');

            selectedDay = day;
            document.getElementById('selectedDay').innerText = "Day " + day;
            document.getElementById('statusMsg').innerText = "";
        }

        async function saveLunch() {
            const lunch = document.getElementById('lunchOption').value;
            if (!selectedDay || !lunch) {
                alert("Please select a day and a lunch option.");
                return;
            }

            const response = await fetch("/save_lunch", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, day: selectedDay, lunch, year, month })
            });

            const data = await response.json();
            document.getElementById('statusMsg').innerText = data.message;

            // Update the day box with lunch emoji/text
            const dayBox = document.getElementById(`day-${selectedDay}`);
            let label = dayBox.querySelector(".lunch-label");
            if (!label) {
                label = document.createElement("div");
                label.className = "lunch-label";
                dayBox.appendChild(label);
            }
            label.innerText = lunch;
        }
    </script>
</body>
</html>

